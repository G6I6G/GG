
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ùÑÔ∏è –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –°–∞–ø—ë—Ä | –ó–∏–º–Ω—è—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        /* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow-y: auto;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a192f 0%, #1a365d 50%, #0f3460 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* –°–ù–ï–ñ–ò–ù–ö–ò */
        .snowflakes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .snowflake {
            position: absolute;
            top: -10px;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            filter: blur(0.5px);
        }

        .snowflake.small {
            width: 3px;
            height: 3px;
        }

        .snowflake.medium {
            width: 5px;
            height: 5px;
        }

        .snowflake.large {
            width: 7px;
            height: 7px;
        }

        /* –ê–ù–ò–ú–ê–¶–ò–ò –°–ù–ï–ñ–ò–ù–û–ö */
        @keyframes fall {
            0% {
                transform: translateY(-10px) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            90% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh) translateX(var(--sway, 0px));
                opacity: 0;
            }
        }
        
        @keyframes sway {
            0%, 100% {
                transform: translateX(0);
            }
            50% {
                transform: translateX(var(--sway-distance, 20px));
            }
        }
        
        @keyframes wave {
            0% { transform: scale(0.5); opacity: 1; border-width: 3px; }
            100% { transform: scale(3); opacity: 0; border-width: 1px; }
        }

        /* –ö–û–ù–¢–ï–ô–ù–ï–† –ò–ì–†–´ */
        .game-container {
            width: 100%;
            max-width: 1300px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            position: relative;
            z-index: 2;
            margin: 20px 0;
        }

        /* –®–ê–ü–ö–ê */
        .header {
            text-align: center;
            margin-bottom: 15px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.03) 100%);
            z-index: -1;
        }

        .header h1 {
            font-size: 3.2rem;
            background: linear-gradient(45deg, #4cc9f0, #4361ee, #f72585);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% auto;
            animation: gradient 4s ease infinite;
            font-weight: 900;
            margin-bottom: 10px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            letter-spacing: 1px;
        }

        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .header .subtitle {
            color: #a5b4cb;
            font-size: 1.1rem;
            font-weight: 300;
            letter-spacing: 0.5px;
        }

        /* –û–°–ù–û–í–ù–ê–Ø –û–ë–õ–ê–°–¢–¨ */
        .main-game-area {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            min-height: 600px;
        }

        /* –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ - –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò –¢–ê–ô–ú–ï–†–´ */
        .left-panel {
            flex: 0 0 350px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        /* –ü–ê–ù–ï–õ–¨ –°–¢–ê–¢–ò–°–¢–ò–ö–ò */
        .stats-panel {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
            position: relative;
            overflow: hidden;
        }

        .stats-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 30%, rgba(100, 200, 255, 0.05) 100%);
            z-index: -1;
        }

        .stats-display {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: linear-gradient(145deg, rgba(30, 40, 60, 0.8), rgba(20, 30, 50, 0.8));
            border-radius: 20px;
            padding: 25px 20px;
            text-align: center;
            border: 1px solid rgba(76, 201, 240, 0.3);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .stat-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(76, 201, 240, 0.1), transparent);
            transition: left 0.6s;
        }

        .stat-box:hover::before {
            left: 100%;
        }

        .stat-box:hover {
            transform: translateY(-8px) scale(1.03);
            border-color: rgba(76, 201, 240, 0.6);
            box-shadow: 0 10px 25px rgba(76, 201, 240, 0.2);
        }

        .stat-value {
            font-size: 2.8rem;
            font-weight: 800;
            color: #4cc9f0;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 15px rgba(76, 201, 240, 0.5);
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #a5b4cb;
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 600;
        }

        /* –¢–ê–ô–ú–ï–† */
        .timer-container {
            text-align: center;
            padding: 20px;
            background: linear-gradient(145deg, rgba(30, 40, 60, 0.9), rgba(20, 30, 50, 0.9));
            border-radius: 20px;
            border: 2px solid rgba(76, 201, 240, 0.4);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .timer-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(76, 201, 240, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .timer-title {
            font-size: 1.2rem;
            color: #a5b4cb;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
        }

        .timer-display {
            font-size: 4.5rem;
            font-weight: 900;
            color: #4cc9f0;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 20px rgba(76, 201, 240, 0.7);
            letter-spacing: 5px;
            transition: all 0.3s ease;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .timer-display.changing {
            animation: pulse 0.5s ease;
            color: #f72585;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø */
        .control-panel {
            flex: 0 0 350px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
            position: relative;
            overflow: hidden;
        }

        .control-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 30%, rgba(67, 97, 238, 0.05) 100%);
            z-index: -1;
        }

        /* –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø */
        .control-buttons {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }

        .btn {
            padding: 20px 25px;
            border: none;
            border-radius: 18px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0) scale(0.98);
            transition: all 0.1s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4361ee, #3a56d4);
            color: white;
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #3a56d4, #2f48b9);
            box-shadow: 0 12px 30px rgba(67, 97, 238, 0.6);
        }

        .btn-success {
            background: linear-gradient(135deg, #4cc9f0, #3ab5d9);
            color: white;
            box-shadow: 0 8px 20px rgba(76, 201, 240, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #3ab5d9, #2aa1c2);
            box-shadow: 0 12px 30px rgba(76, 201, 240, 0.6);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f72585, #e01e76);
            color: white;
            box-shadow: 0 8px 20px rgba(247, 37, 133, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #e01e76, #c91767);
            box-shadow: 0 12px 30px rgba(247, 37, 133, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.15));
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        /* –ù–ê–°–¢–†–û–ô–ö–ò */
        .settings-panel {
            background: rgba(30, 40, 60, 0.9);
            border-radius: 20px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid rgba(76, 201, 240, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .settings-title {
            font-size: 1.2rem;
            color: #4cc9f0;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .setting-group {
            margin-bottom: 20px;
        }

        .setting-label {
            display: block;
            color: #a5b4cb;
            font-size: 0.95rem;
            margin-bottom: 10px;
            font-weight: 500;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #2d3748, #4a5568);
            outline: none;
            -webkit-appearance: none;
            transition: all 0.3s;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4cc9f0;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(76, 201, 240, 0.5);
            border: 2px solid white;
            transition: all 0.3s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: #3ab5d9;
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(76, 201, 240, 0.7);
        }

        .range-value {
            display: inline-block;
            min-width: 45px;
            text-align: right;
            color: #4cc9f0;
            font-weight: 700;
            margin-left: 10px;
            font-size: 1.1rem;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        input[type="checkbox"] {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            appearance: none;
            cursor: pointer;
            position: relative;
            border: 2px solid rgba(76, 201, 240, 0.3);
            transition: all 0.3s;
        }

        input[type="checkbox"]:checked {
            background: #4cc9f0;
            border-color: #4cc9f0;
        }

        input[type="checkbox"]:checked::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        /* –ó–í–£–ö–ò */
        .sound-controls {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .audio-panel {
            background: rgba(40, 50, 70, 0.9);
            border-radius: 18px;
            padding: 20px;
            margin-top: 20px;
        }

        .audio-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            margin-bottom: 20px;
        }

        .audio-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, rgba(76, 201, 240, 0.2), rgba(67, 97, 238, 0.2));
            border: 1px solid rgba(76, 201, 240, 0.4);
            color: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .audio-btn:hover {
            background: linear-gradient(135deg, rgba(76, 201, 240, 0.3), rgba(67, 97, 238, 0.3));
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(76, 201, 240, 0.3);
        }

        .audio-upload {
            display: none;
        }

        .audio-upload-label {
            padding: 12px 20px;
            background: linear-gradient(135deg, rgba(247, 37, 133, 0.2), rgba(230, 30, 118, 0.2));
            border: 1px solid rgba(247, 37, 133, 0.4);
            color: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .audio-upload-label:hover {
            background: linear-gradient(135deg, rgba(247, 37, 133, 0.3), rgba(230, 30, 118, 0.3));
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(247, 37, 133, 0.3);
        }

        .audio-status {
            font-size: 0.9rem;
            color: #a5b4cb;
            margin-top: 15px;
            display: block;
            font-style: italic;
        }

        /* –ò–ì–†–û–í–û–ï –ü–û–õ–ï */
        .game-board-area {
            flex: 1;
            min-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .game-board-wrapper {
            background: rgba(15, 25, 45, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 30px;
            border: 1px solid rgba(76, 201, 240, 0.3);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
            min-height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .game-board-wrapper::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(76, 201, 240, 0.08) 0%, transparent 70%);
            z-index: 0;
            animation: pulse-glow 4s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }

        .game-board {
            display: inline-grid;
            gap: 6px;
            background: rgba(10, 20, 40, 0.9);
            padding: 25px;
            border-radius: 20px;
            position: relative;
            z-index: 1;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.5);
        }

        /* –ö–õ–ï–¢–ö–ò */
        .cell {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.3rem;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: linear-gradient(145deg, #2d3748, #1a202c);
            box-shadow: 
                inset 3px 3px 6px rgba(0, 0, 0, 0.6),
                inset -3px -3px 6px rgba(255, 255, 255, 0.05),
                4px 4px 8px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        .cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 40%, rgba(255, 255, 255, 0.03) 100%);
            border-radius: 12px;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .cell {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }
        }

        @media (max-width: 480px) {
            .cell {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }

        .cell:hover:not(.revealed):not(.flagged) {
            transform: scale(1.08) rotate(2deg);
            box-shadow: 
                inset 3px 3px 6px rgba(0, 0, 0, 0.6),
                inset -3px -3px 6px rgba(255, 255, 255, 0.05),
                8px 8px 16px rgba(0, 0, 0, 0.5);
            background: linear-gradient(145deg, #374151, #2d3748);
        }

        .cell:active:not(.revealed):not(.flagged) {
            transform: scale(0.95);
            box-shadow: 
                inset 4px 4px 8px rgba(0, 0, 0, 0.7),
                inset -4px -4px 8px rgba(255, 255, 255, 0.1);
            transition: all 0.1s;
        }

        .cell.revealed {
            background: rgba(30, 40, 60, 0.95);
            box-shadow: inset 3px 3px 8px rgba(0, 0, 0, 0.8);
            cursor: default;
            animation: reveal-cell 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: scale(1);
        }

        @keyframes reveal-cell {
            0% { transform: scale(0.7) rotate(-10deg); opacity: 0; }
            70% { transform: scale(1.05) rotate(5deg); }
            100% { transform: scale(1) rotate(0); opacity: 1; }
        }

        .cell.mine {
            background: linear-gradient(145deg, #ff4757, #ff3838);
            animation: mine-pulse 1.2s infinite;
        }

        @keyframes mine-pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 20px rgba(255, 71, 87, 0.8);
            }
            50% { 
                transform: scale(1.08);
                box-shadow: 0 0 35px rgba(255, 71, 87, 1);
            }
        }

        .cell.dynamic-bomb {
            background: linear-gradient(145deg, #ff9f43, #ff7f00);
            animation: bomb-pulse 1.8s infinite;
        }

        @keyframes bomb-pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 20px rgba(255, 159, 67, 0.8);
            }
            50% { 
                transform: scale(1.12);
                box-shadow: 0 0 40px rgba(255, 159, 67, 1);
            }
        }

        .cell.flagged {
            position: relative;
        }

        .cell.flagged::before {
            content: 'üö©';
            font-size: 1.4rem;
            animation: flag-wave 2.5s ease-in-out infinite;
            position: relative;
            z-index: 2;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        @keyframes flag-wave {
            0%, 100% { transform: rotate(0deg) translateY(0); }
            25% { transform: rotate(12deg) translateY(-3px); }
            75% { transform: rotate(-12deg) translateY(-3px); }
        }

        /* –¶–í–ï–¢–ê –ß–ò–°–ï–õ */
        .cell.number-1 { color: #4cc9f0; text-shadow: 0 0 12px rgba(76, 201, 240, 0.7); }
        .cell.number-2 { color: #2ecc71; text-shadow: 0 0 12px rgba(46, 204, 113, 0.7); }
        .cell.number-3 { color: #f72585; text-shadow: 0 0 12px rgba(247, 37, 133, 0.7); }
        .cell.number-4 { color: #9b59b6; text-shadow: 0 0 12px rgba(155, 89, 182, 0.7); }
        .cell.number-5 { color: #f39c12; text-shadow: 0 0 12px rgba(243, 156, 18, 0.7); }
        .cell.number-6 { color: #1abc9c; text-shadow: 0 0 12px rgba(26, 188, 156, 0.7); }
        .cell.number-7 { color: #e67e22; text-shadow: 0 0 12px rgba(230, 126, 34, 0.7); }
        .cell.number-8 { color: #95a5a6; text-shadow: 0 0 12px rgba(149, 165, 166, 0.7); }

        /* –¶–í–ï–¢–ê –î–õ–Ø –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–• –ë–û–ú–ë */
        .cell.dynamic-bombs-1 { color: #ff9f43; text-shadow: 0 0 12px rgba(255, 159, 67, 0.7); }
        .cell.dynamic-bombs-2 { color: #ff7f00; text-shadow: 0 0 12px rgba(255, 127, 0, 0.7); }
        .cell.dynamic-bombs-3 { color: #ff5500; text-shadow: 0 0 12px rgba(255, 85, 0, 0.7); }

        /* –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù */
        .start-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 25, 47, 0.98);
            backdrop-filter: blur(30px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 30px;
            padding: 40px;
            text-align: center;
            z-index: 100;
            animation: fadeIn 0.6s ease-out;
            border-radius: 30px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .start-screen.hidden {
            display: none;
        }

        .start-screen h2 {
            font-size: 3.5rem;
            background: linear-gradient(45deg, #4cc9f0, #4361ee, #f72585);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 900;
            text-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .start-screen p {
            color: #a5b4cb;
            max-width: 600px;
            line-height: 1.7;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .start-screen .btn {
            margin-top: 30px;
            font-size: 1.3rem;
            padding: 20px 50px;
            border-radius: 20px;
        }

        .game-instructions {
            margin: 30px 0;
            padding: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
            max-width: 500px;
        }

        .instructions-title {
            font-size: 1.1rem;
            color: #4cc9f0;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
        }

        .instructions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            font-size: 0.95rem;
        }

        .instruction-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instruction-key {
            background: rgba(76, 201, 240, 0.2);
            padding: 5px 10px;
            border-radius: 8px;
            font-weight: 700;
            color: #4cc9f0;
            min-width: 80px;
            text-align: center;
        }

        /* –°–û–û–ë–©–ï–ù–ò–Ø */
        .message {
            position: fixed;
            top: 30px;
            right: 30px;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.95), rgba(76, 201, 240, 0.95));
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            animation: slideInRight 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
            max-width: 350px;
            border-left: 5px solid #f72585;
            backdrop-filter: blur(10px);
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%) translateY(-20px); opacity: 0; }
            to { transform: translateX(0) translateY(0); opacity: 1; }
        }

        /* –°–¢–ò–õ–ò –î–õ–Ø –≠–°–ö–ï–ô–ü-–°–ò–°–¢–ï–ú–´ */
        .preset-btn {
            padding: 10px 15px;
            background: linear-gradient(135deg, rgba(76, 201, 240, 0.2), rgba(67, 97, 238, 0.2));
            border: 1px solid rgba(76, 201, 240, 0.4);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 600;
            flex: 1;
            min-width: 100px;
        }

        .preset-btn:hover {
            background: linear-gradient(135deg, rgba(76, 201, 240, 0.3), rgba(67, 97, 238, 0.3));
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(76, 201, 240, 0.3);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ */
        @keyframes savePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .saving {
            animation: savePulse 0.5s ease;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ */
        .export-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 25, 45, 0.95);
            padding: 30px;
            border-radius: 20px;
            border: 2px solid rgba(76, 201, 240, 0.5);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            z-index: 10000;
            max-width: 500px;
            width: 90%;
            backdrop-filter: blur(20px);
        }

        .export-content {
            background: rgba(30, 40, 60, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-top: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            max-height: 200px;
            overflow-y: auto;
        }

        .export-content pre {
            color: #4cc9f0;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-width: 1200px) {
            .main-game-area {
                flex-direction: column;
            }
            
            .left-panel, .control-panel {
                flex: none;
                width: 100%;
            }
            
            .game-board-area {
                min-width: 100%;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .stats-display {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .stat-value {
                font-size: 2.2rem;
            }
            
            .timer-display {
                font-size: 3.5rem;
                min-height: 70px;
            }
            
            .instructions-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-display {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
            
            .start-screen h2 {
                font-size: 2.5rem;
            }
            
            .control-panel, .stats-panel {
                padding: 20px;
            }
            
            .game-board-wrapper {
                padding: 15px;
            }
            
            .timer-display {
                font-size: 2.8rem;
                letter-spacing: 3px;
                min-height: 60px;
            }
        }
    </style>
</head>
<body>
    <!-- –°–ù–ï–ñ–ò–ù–ö–ò -->
    <div class="snowflakes" id="snowflakes"></div>

    <div class="game-container">
        <!-- –®–ê–ü–ö–ê -->
        <div class="header">
            <h1>‚ùÑÔ∏è –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –°–∞–ø—ë—Ä</h1>
            <p class="subtitle">–ó–∏–º–Ω—è—è –≤–µ—Ä—Å–∏—è —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫–æ–π, –∑–≤—É–∫–∞–º–∏ –∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏</p>
        </div>

        <!-- –û–°–ù–û–í–ù–ê–Ø –û–ë–õ–ê–°–¢–¨ -->
        <div class="main-game-area">
            <!-- –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ -->
            <div class="left-panel">
                <!-- –ü–ê–ù–ï–õ–¨ –°–¢–ê–¢–ò–°–¢–ò–ö–ò -->
                <div class="stats-panel">
                    <div class="stats-display">
                        <div class="stat-box">
                            <div class="stat-value" id="timer">000</div>
                            <div class="stat-label">–í–†–ï–ú–Ø</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="mine-count">015</div>
                            <div class="stat-label">–ú–ò–ù–´</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="bomb-count">3</div>
                            <div class="stat-label">–î–ò–ù–ê–ú. –ë–û–ú–ë–´</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="bomb-timer">12</div>
                            <div class="stat-label">–°–õ–ï–î. –•–û–î –ë–û–ú–ë</div>
                        </div>
                    </div>

                    <!-- –¢–ê–ô–ú–ï–† -->
                    <div class="timer-container">
                        <div class="timer-title">–¢–ê–ô–ú–ï–† –ò–ì–†–´</div>
                        <div class="timer-display" id="main-timer">000</div>
                    </div>
                </div>

                <!-- –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
                <div class="control-panel">
                    <!-- –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
                    <div class="control-buttons">
                        <button class="btn btn-success" id="start-game">
                            <span>üöÄ</span> –ù–ê–ß–ê–¢–¨ –ò–ì–†–£
                        </button>
                        <button class="btn btn-primary" id="restart-btn">
                            <span>üîÑ</span> –ù–û–í–ê–Ø –ò–ì–†–ê
                        </button>
                        <button class="btn btn-warning" id="hint-btn">
                            <span>üí°</span> –ü–û–î–°–ö–ê–ó–ö–ê
                        </button>
                        <button class="btn btn-secondary" id="undo-btn">
                            <span>‚Ü©</span> –û–¢–ú–ï–ù–ò–¢–¨ –•–û–î
                        </button>
                    </div>

                    <!-- –ù–ê–°–¢–†–û–ô–ö–ò -->
                    <div class="settings-panel">
                        <div class="settings-title">‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò –ò–ì–†–´</div>
                        
                        <div class="setting-group">
                            <label class="setting-label">
                                –†–∞–∑–º–µ—Ä –ø–æ–ª—è: <span class="range-value" id="size-value">10√ó10</span>
                            </label>
                            <input type="range" id="board-size" min="5" max="15" value="10">
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">
                                –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω: <span class="range-value" id="mine-value">15</span>
                            </label>
                            <input type="range" id="mine-count-slider" min="5" max="40" value="15">
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">
                                –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –±–æ–º–±: <span class="range-value" id="bomb-value">3</span>
                            </label>
                            <input type="range" id="dynamic-bomb-count" min="1" max="10" value="3">
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="smart-gen" checked>
                            <label class="setting-label">–£–º–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–±–µ–∑ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤)</label>
                        </div>
                        
                        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤—É–∫–æ–º -->
                        <div class="sound-controls">
                            <div class="checkbox-group">
                                <input type="checkbox" id="sound-toggle" checked>
                                <label class="setting-label">üîä –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="music-toggle" checked>
                                <label class="setting-label">üéµ –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞</label>
                            </div>
                            
                            <!-- –§–û–ù–û–í–ê–Ø –ú–£–ó–´–ö–ê -->
                            <div class="audio-panel">
                                <div class="settings-title">üéµ –£–ü–†–ê–í–õ–ï–ù–ò–ï –ó–í–£–ö–û–ú</div>
                                
                                <div class="setting-group">
                                    <label class="setting-label">–ì—Ä–æ–º–∫–æ—Å—Ç—å –º—É–∑—ã–∫–∏: <span class="range-value" id="music-volume-value">50</span>%</label>
                                    <input type="range" id="music-volume" min="0" max="100" value="50">
                                </div>
                                
                                <div class="setting-group">
                                    <label class="setting-label">–ì—Ä–æ–º–∫–æ—Å—Ç—å –∑–≤—É–∫–æ–≤: <span class="range-value" id="sfx-volume-value">70</span>%</label>
                                    <input type="range" id="sfx-volume" min="0" max="100" value="70">
                                </div>
                                
                                <div class="audio-controls">
                                    <button class="audio-btn" id="play-music">‚ñ∂ –í–∫–ª—é—á–∏—Ç—å</button>
                                    <button class="audio-btn" id="pause-music">‚è∏ –ü–∞—É–∑–∞</button>
                                    <button class="audio-btn" id="stop-music">‚èπ –°—Ç–æ–ø</button>
                                    
                                    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤–æ–µ–π –º—É–∑—ã–∫–∏ -->
                                    <label for="music-upload" class="audio-upload-label">
                                        üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å MP3
                                    </label>
                                    <input type="file" id="music-upload" class="audio-upload" accept="audio/mp3,audio/*">
                                </div>
                                
                                <span class="audio-status" id="music-status">üé∂ –ú—É–∑—ã–∫–∞: –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–Ω—ã–π —Å–∞—É–Ω–¥—Ç—Ä–µ–∫</span>
                            </div>
                        </div>

                        <!-- –≠–°–ö–ï–ô–ü-–°–ò–°–¢–ï–ú–ê –° –ù–ê–°–¢–†–û–ô–ö–ê–ú–ò -->
                        <div class="setting-group">
                            <div class="settings-title">üíæ –£–ü–†–ê–í–õ–ï–ù–ò–ï –ù–ê–°–¢–†–û–ô–ö–ê–ú–ò</div>
                            
                            <div class="settings-presets">
                                <div class="setting-group">
                                    <label class="setting-label">–ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ—Å–µ—Ç—ã:</label>
                                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                                        <button class="audio-btn preset-btn" data-preset="beginner">üéÆ –ù–∞—á–∏–Ω–∞—é—â–∏–π</button>
                                        <button class="audio-btn preset-btn" data-preset="medium">‚ö° –°—Ä–µ–¥–Ω–∏–π</button>
                                        <button class="audio-btn preset-btn" data-preset="expert">üî• –≠–∫—Å–ø–µ—Ä—Ç</button>
                                        <button class="audio-btn preset-btn" data-preset="hardcore">üíÄ –•–∞—Ä–¥–∫–æ—Ä</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-controls" style="margin-top: 25px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                                <div class="setting-group">
                                    <label class="setting-label">–ò–º—è –ø—Ä–æ—Ñ–∏–ª—è:</label>
                                    <input type="text" id="profile-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" 
                                           style="width: 100%; padding: 12px; border-radius: 12px; background: rgba(255,255,255,0.1); 
                                                  color: white; border: 1px solid rgba(76, 201, 240, 0.3); margin: 10px 0; font-size: 1rem;">
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 15px;">
                                    <button class="btn btn-secondary" id="save-profile">
                                        <span>üíæ</span> –°–û–•–†–ê–ù–ò–¢–¨
                                    </button>
                                    <button class="btn btn-secondary" id="load-profile">
                                        <span>üìÇ</span> –ó–ê–ì–†–£–ó–ò–¢–¨
                                    </button>
                                    <button class="btn btn-warning" id="export-settings">
                                        <span>üì§</span> –≠–ö–°–ü–û–†–¢
                                    </button>
                                    <button class="btn btn-warning" id="import-settings">
                                        <span>üì•</span> –ò–ú–ü–û–†–¢
                                    </button>
                                    <button class="btn btn-secondary" id="reset-settings" style="grid-column: span 2;">
                                        <span>üîÑ</span> –°–ë–†–û–° –ù–ê–°–¢–†–û–ï–ö
                                    </button>
                                </div>
                                
                                <div class="audio-status" id="profile-status" style="margin-top: 15px;">
                                    üíæ –ì–æ—Ç–æ–≤ –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é...
                                </div>
                                
                                <!-- –°–∫—Ä—ã—Ç—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ -->
                                <input type="file" id="import-file" accept=".json" style="display: none;">
                            </div>
                            
                            <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
                            <div class="current-settings" style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 12px;">
                                <div class="settings-title">üìä –¢–ï–ö–£–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò</div>
                                <div id="current-settings-display" style="color: #a5b4cb; font-size: 0.85rem; margin-top: 10px; line-height: 1.5;">
                                    –†–∞–∑–º–µ—Ä: 10√ó10 | –ú–∏–Ω—ã: 15 | –ë–æ–º–±—ã: 3 | –ú—É–∑—ã–∫–∞: –í–ö–õ
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ò–ì–†–û–í–û–ï –ü–û–õ–ï -->
            <div class="game-board-area">
                <div class="game-board-wrapper">
                    <!-- –ò–ì–†–û–í–û–ï –ü–û–õ–ï -->
                    <div class="game-board" id="game-board"></div>
                    
                    <!-- –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù -->
                    <div class="start-screen" id="start-screen">
                        <h2>–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å?</h2>
                        <p>
                            –ó–∏–º–Ω—è—è –≤–µ—Ä—Å–∏—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ —Å–∞–ø—ë—Ä–∞ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫–æ–π, 
                            –ø—Ä–∏—è—Ç–Ω—ã–º–∏ –∑–≤—É–∫–∞–º–∏ –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –±–æ–º–±–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –ø–æ –ø–æ–ª—é.
                        </p>
                        <p style="color: #4cc9f0; font-weight: 700; font-size: 1.3rem;">
                            üéØ –¶–µ–ª—å: –æ—Ç–∫—Ä—ã—Ç—å –≤—Å–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫–ª–µ—Ç–∫–∏, –Ω–µ –ø–æ–ø–∞–≤ –Ω–∞ –º–∏–Ω—É!
                        </p>
                        
                        <div class="game-instructions">
                            <div class="instructions-title">üéÆ –£–ü–†–ê–í–õ–ï–ù–ò–ï:</div>
                            <div class="instructions-grid">
                                <div class="instruction-item">
                                    <div class="instruction-key">–õ–ö–ú</div>
                                    <div>–û—Ç–∫—Ä—ã—Ç—å –∫–ª–µ—Ç–∫—É</div>
                                </div>
                                <div class="instruction-item">
                                    <div class="instruction-key">–ü–ö–ú</div>
                                    <div>–ü–æ—Å—Ç–∞–≤–∏—Ç—å —Ñ–ª–∞–≥</div>
                                </div>
                                <div class="instruction-item">
                                    <div class="instruction-key">Ctrl + Z</div>
                                    <div>–û—Ç–º–µ–Ω–∏—Ç—å —Ö–æ–¥</div>
                                </div>
                                <div class="instruction-item">
                                    <div class="instruction-key">–ü–†–û–ë–ï–õ</div>
                                    <div>–ü–æ–¥—Å–∫–∞–∑–∫–∞</div>
                                </div>
                                <div class="instruction-item">
                                    <div class="instruction-key">R</div>
                                    <div>–ù–æ–≤–∞—è –∏–≥—Ä–∞</div>
                                </div>
                                <div class="instruction-item">
                                    <div class="instruction-key">M</div>
                                    <div>–í–∫–ª/–≤—ã–∫–ª –º—É–∑—ã–∫—É</div>
                                </div>
                                <div class="instruction-item">
                                    <div class="instruction-key">Escape</div>
                                    <div>–ë—ã—Å—Ç—Ä–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-success" id="start-button-main">
                            <span>üéÆ</span> –ù–ê–ß–ê–¢–¨ –ò–ì–†–£
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø –° –†–ê–ë–û–¢–ê–Æ–©–ò–ú–ò –†–ï–ì–£–õ–Ø–¢–û–†–ê–ú–ò –ó–í–£–ö–ê –ò –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ú–ò –ë–û–ú–ë–ê–ú–ò
        
        const Game = {
            // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
            config: {
                rows: 10,
                cols: 10,
                mines: 15,
                dynamicBombs: 3,
                bombInterval: 12000,
                smartGeneration: true,
                soundEnabled: true,
                musicEnabled: true,
                snowflakesCount: 80,
                musicVolume: 0.5,
                sfxVolume: 0.7
            },
            
            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
            state: {
                board: [],
                gameOver: false,
                gameWon: false,
                firstClick: true,
                flaggedCount: 0,
                revealedCount: 0,
                startTime: null,
                timerInterval: null,
                bombTimer: null,
                bombMoveCounter: 0,
                elapsedSeconds: 0,
                lastMoveHistory: [],
                audioContext: null,
                sounds: {},
                backgroundMusic: null,
                isMusicPlaying: false,
                musicSource: null,
                snowflakes: [],
                musicAnalyser: null,
                musicDataArray: null,
                musicGainNode: null,
                sfxGainNode: null,
                musicOscillators: null,
                musicGains: null
            },
            
            // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
            elements: {},
            
            // –≠–°–ö–ï–ô–ü-–°–ò–°–¢–ï–ú–ê –° –ù–ê–°–¢–†–û–ô–ö–ê–ú–ò
            escapeSystem: {
                // –ü—Ä–µ—Å–µ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫
                presets: {
                    beginner: {
                        rows: 8, cols: 8,
                        mines: 10,
                        dynamicBombs: 1,
                        smartGeneration: true,
                        soundEnabled: true,
                        musicEnabled: true,
                        musicVolume: 0.4,
                        sfxVolume: 0.5,
                        bombInterval: 15000
                    },
                    medium: {
                        rows: 10, cols: 10,
                        mines: 15,
                        dynamicBombs: 2,
                        smartGeneration: true,
                        soundEnabled: true,
                        musicEnabled: true,
                        musicVolume: 0.5,
                        sfxVolume: 0.6,
                        bombInterval: 12000
                    },
                    expert: {
                        rows: 12, cols: 12,
                        mines: 25,
                        dynamicBombs: 3,
                        smartGeneration: false,
                        soundEnabled: true,
                        musicEnabled: true,
                        musicVolume: 0.6,
                        sfxVolume: 0.7,
                        bombInterval: 10000
                    },
                    hardcore: {
                        rows: 15, cols: 15,
                        mines: 40,
                        dynamicBombs: 5,
                        smartGeneration: false,
                        soundEnabled: true,
                        musicEnabled: false,
                        musicVolume: 0,
                        sfxVolume: 0.8,
                        bombInterval: 8000
                    }
                },

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç—Å–∫–µ–π–ø-—Å–∏—Å—Ç–µ–º—ã
                init() {
                    this.bindEscapeEvents();
                    this.loadLastProfile();
                    this.updateCurrentSettings();
                },

                // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
                loadLastProfile() {
                    try {
                        const lastProfile = localStorage.getItem('minesweeper_lastProfile');
                        if (lastProfile) {
                            this.loadProfile(lastProfile);
                            Game.showMessage(`üìÇ –ó–∞–≥—Ä—É–∂–µ–Ω –ø—Ä–æ—Ñ–∏–ª—å: ${lastProfile}`);
                        }
                    } catch (e) {
                        console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–æ—Ñ–∏–ª—å:', e);
                    }
                },

                // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
                bindEscapeEvents() {
                    // –ü—Ä–µ—Å–µ—Ç—ã
                    document.querySelectorAll('.preset-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const preset = e.target.dataset.preset;
                            this.applyPreset(preset);
                            Game.playSound('click');
                        });
                    });

                    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
                    document.getElementById('save-profile').addEventListener('click', () => {
                        this.saveProfile();
                        Game.playSound('click');
                    });

                    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
                    document.getElementById('load-profile').addEventListener('click', () => {
                        this.loadProfile();
                        Game.playSound('click');
                    });

                    // –≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫
                    document.getElementById('export-settings').addEventListener('click', () => {
                        this.exportSettings();
                        Game.playSound('click');
                    });

                    // –ò–º–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫
                    document.getElementById('import-settings').addEventListener('click', () => {
                        document.getElementById('import-file').click();
                        Game.playSound('click');
                    });

                    document.getElementById('import-file').addEventListener('change', (e) => {
                        this.importSettings(e.target.files[0]);
                    });

                    // –°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫
                    document.getElementById('reset-settings').addEventListener('click', () => {
                        if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {
                            this.resetToDefaults();
                            Game.playSound('click');
                        }
                    });

                    // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –¥–ª—è —ç—Å–∫–µ–π–ø–∞
                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape') {
                            e.preventDefault();
                            this.quickSave();
                        } else if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                            e.preventDefault();
                            this.saveProfile();
                        } else if (e.ctrlKey && e.shiftKey && e.key === 'L') {
                            e.preventDefault();
                            this.loadProfile();
                        }
                    });
                },

                // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–µ—Å–µ—Ç–∞
                applyPreset(presetName) {
                    const preset = this.presets[presetName];
                    if (!preset) return;

                    Object.keys(preset).forEach(key => {
                        if (key in Game.config) {
                            Game.config[key] = preset[key];
                        }
                    });

                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                    this.updateSettingsUI();
                    Game.updateUI();
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
                    if (Game.state.musicGainNode) {
                        Game.state.musicGainNode.gain.value = Game.config.musicVolume;
                    }
                    if (Game.state.sfxGainNode) {
                        Game.state.sfxGainNode.gain.value = Game.config.sfxVolume;
                    }

                    Game.showMessage(`üéÆ –ü—Ä–∏–º–µ–Ω–µ–Ω –ø—Ä–µ—Å–µ—Ç: ${presetName.toUpperCase()}`);
                    this.updateCurrentSettings();
                },

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
                updateCurrentSettings() {
                    const display = document.getElementById('current-settings-display');
                    if (!display) return;

                    const settings = Game.config;
                    const musicStatus = settings.musicEnabled ? '–í–ö–õ' : '–í–´–ö–õ';
                    const soundStatus = settings.soundEnabled ? '–í–ö–õ' : '–í–´–ö–õ';
                    
                    display.innerHTML = `
                        <div>üìê –†–∞–∑–º–µ—Ä: ${settings.rows}√ó${settings.cols}</div>
                        <div>üí£ –ú–∏–Ω—ã: ${settings.mines} | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –±–æ–º–±—ã: ${settings.dynamicBombs}</div>
                        <div>üéµ –ú—É–∑—ã–∫–∞: ${musicStatus} (${Math.round(settings.musicVolume * 100)}%)</div>
                        <div>üîä –ó–≤—É–∫–∏: ${soundStatus} (${Math.round(settings.sfxVolume * 100)}%)</div>
                        <div>‚ö° –ò–Ω—Ç–µ—Ä–≤–∞–ª –±–æ–º–±: ${settings.bombInterval / 1000} —Å–µ–∫</div>
                    `;
                },

                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
                saveProfile() {
                    const profileNameInput = document.getElementById('profile-name');
                    let profileName = profileNameInput.value.trim();
                    
                    if (!profileName) {
                        profileName = `profile_${Date.now()}`;
                        profileNameInput.value = profileName;
                    }

                    const profile = {
                        config: { ...Game.config },
                        version: '1.0',
                        timestamp: new Date().toISOString(),
                        gameStats: {
                            totalGames: 0,
                            wins: 0,
                            bestTime: 999
                        }
                    };

                    try {
                        localStorage.setItem(`minesweeper_profile_${profileName}`, JSON.stringify(profile));
                        localStorage.setItem('minesweeper_lastProfile', profileName);
                        
                        document.getElementById('profile-status').textContent = 
                            `üíæ –ü—Ä–æ—Ñ–∏–ª—å "${profileName}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω (${new Date().toLocaleTimeString()})`;
                        
                        document.getElementById('save-profile').classList.add('saving');
                        setTimeout(() => {
                            document.getElementById('save-profile').classList.remove('saving');
                        }, 500);
                        
                        Game.showMessage(`üíæ –ü—Ä–æ—Ñ–∏–ª—å "${profileName}" —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!`);
                        this.updateCurrentSettings();
                    } catch (e) {
                        Game.showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è');
                        console.error('Save error:', e);
                    }
                },

                // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
                loadProfile(profileName = null) {
                    if (!profileName) {
                        const profileNameInput = document.getElementById('profile-name');
                        profileName = profileNameInput.value.trim();
                        
                        if (!profileName) {
                            Game.showMessage('‚ùå –í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏');
                            return;
                        }
                    }

                    try {
                        const saved = localStorage.getItem(`minesweeper_profile_${profileName}`);
                        if (!saved) {
                            Game.showMessage(`‚ùå –ü—Ä–æ—Ñ–∏–ª—å "${profileName}" –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                            return;
                        }

                        const profile = JSON.parse(saved);
                        
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                        Object.keys(profile.config).forEach(key => {
                            if (key in Game.config) {
                                Game.config[key] = profile.config[key];
                            }
                        });

                        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                        this.updateSettingsUI();
                        Game.updateUI();
                        
                        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ
                        if (Game.state.musicGainNode) {
                            Game.state.musicGainNode.gain.value = Game.config.musicVolume;
                        }
                        if (Game.state.sfxGainNode) {
                            Game.state.sfxGainNode.gain.value = Game.config.sfxVolume;
                        }

                        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                        document.getElementById('profile-name').value = profileName;
                        document.getElementById('profile-status').textContent = 
                            `üìÇ –ó–∞–≥—Ä—É–∂–µ–Ω –ø—Ä–æ—Ñ–∏–ª—å "${profileName}"`;
                        
                        Game.showMessage(`üìÇ –ü—Ä–æ—Ñ–∏–ª—å "${profileName}" –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!`);
                        this.updateCurrentSettings();
                        
                    } catch (e) {
                        Game.showMessage('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è');
                        console.error('Load error:', e);
                    }
                },

                // –≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫
                exportSettings() {
                    const exportData = {
                        config: Game.config,
                        version: '1.0',
                        exportDate: new Date().toISOString(),
                        game: 'Winter Minesweeper'
                    };

                    const dataStr = JSON.stringify(exportData, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    
                    // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                    this.showExportModal(dataStr);
                    
                    // –¢–∞–∫–∂–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
                    const url = URL.createObjectURL(dataBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `minesweeper_settings_${Date.now()}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    Game.showMessage('üì§ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª');
                },

                // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞
                showExportModal(dataStr) {
                    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –µ—Å–ª–∏ –µ—Å—Ç—å
                    const oldModal = document.querySelector('.export-modal');
                    if (oldModal) oldModal.remove();

                    const modal = document.createElement('div');
                    modal.className = 'export-modal';
                    modal.innerHTML = `
                        <div class="settings-title">üì§ –≠–ö–°–ü–û–†–¢ –ù–ê–°–¢–†–û–ï–ö</div>
                        <p style="color: #a5b4cb; margin: 15px 0;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!</p>
                        <div class="export-content">
                            <pre>${dataStr.substring(0, 500)}${dataStr.length > 500 ? '...' : ''}</pre>
                        </div>
                        <p style="color: #a5b4cb; margin-top: 10px; font-size: 0.9rem;">
                            –§–∞–π–ª —Å–∫–∞—á–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –≤—ã—à–µ.
                        </p>
                        <button class="btn btn-success" id="copy-export">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
                        <button class="btn btn-secondary" id="close-export" style="margin-top: 10px;">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
                    `;

                    document.body.appendChild(modal);

                    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
                    document.getElementById('copy-export').addEventListener('click', () => {
                        navigator.clipboard.writeText(dataStr).then(() => {
                            Game.showMessage('üìã –ö–æ–¥ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                            modal.querySelector('#copy-export').textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                        });
                    });

                    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                    document.getElementById('close-export').addEventListener('click', () => {
                        modal.remove();
                    });

                    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–∫–Ω–∞
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.remove();
                        }
                    });
                },

                // –ò–º–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫
                importSettings(file) {
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const imported = JSON.parse(e.target.result);
                            
                            if (!imported.config || !imported.version) {
                                throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫');
                            }

                            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                            Object.keys(imported.config).forEach(key => {
                                if (key in Game.config) {
                                    Game.config[key] = imported.config[key];
                                }
                            });

                            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                            this.updateSettingsUI();
                            Game.updateUI();
                            
                            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ
                            if (Game.state.musicGainNode) {
                                Game.state.musicGainNode.gain.value = Game.config.musicVolume;
                            }
                            if (Game.state.sfxGainNode) {
                                Game.state.sfxGainNode.gain.value = Game.config.sfxVolume;
                            }

                            // –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—Ñ–∏–ª—å
                            const profileName = file.name.replace('.json', '') || `imported_${Date.now()}`;
                            document.getElementById('profile-name').value = profileName;
                            
                            Game.showMessage(`üì• –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ "${file.name}"`);
                            this.updateCurrentSettings();
                            
                            if (confirm('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–∫ –ø—Ä–æ—Ñ–∏–ª—å?')) {
                                this.saveProfile();
                            }

                        } catch (e) {
                            Game.showMessage('‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                            console.error('Import error:', e);
                        }
                    };
                    reader.readAsText(file);
                },

                // –ë—ã—Å—Ç—Ä–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–ø–æ Escape)
                quickSave() {
                    const profileName = `quicksave_${new Date().toLocaleDateString()}`;
                    document.getElementById('profile-name').value = profileName;
                    this.saveProfile();
                    Game.showMessage('üíæ –ë—ã—Å—Ç—Ä–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!');
                },

                // –°–±—Ä–æ—Å –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                resetToDefaults() {
                    Game.config = {
                        rows: 10,
                        cols: 10,
                        mines: 15,
                        dynamicBombs: 3,
                        bombInterval: 12000,
                        smartGeneration: true,
                        soundEnabled: true,
                        musicEnabled: true,
                        snowflakesCount: 80,
                        musicVolume: 0.5,
                        sfxVolume: 0.7
                    };

                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                    this.updateSettingsUI();
                    Game.updateUI();
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ
                    if (Game.state.musicGainNode) {
                        Game.state.musicGainNode.gain.value = Game.config.musicVolume;
                    }
                    if (Game.state.sfxGainNode) {
                        Game.state.sfxGainNode.gain.value = Game.config.sfxVolume;
                    }

                    document.getElementById('profile-name').value = 'default';
                    document.getElementById('profile-status').textContent = '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é';
                    
                    Game.showMessage('üîÑ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
                    this.updateCurrentSettings();
                },

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –Ω–∞—Å—Ç—Ä–æ–µ–∫
                updateSettingsUI() {
                    const config = Game.config;
                    
                    // –†–∞–∑–º–µ—Ä –ø–æ–ª—è
                    document.getElementById('board-size').value = config.rows;
                    document.getElementById('size-value').textContent = `${config.rows}√ó${config.cols}`;
                    
                    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω
                    document.getElementById('mine-count-slider').value = config.mines;
                    document.getElementById('mine-value').textContent = config.mines;
                    
                    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –±–æ–º–±—ã
                    document.getElementById('dynamic-bomb-count').value = config.dynamicBombs;
                    document.getElementById('bomb-value').textContent = config.dynamicBombs;
                    
                    // –£–º–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
                    document.getElementById('smart-gen').checked = config.smartGeneration;
                    
                    // –ó–≤—É–∫–∏
                    document.getElementById('sound-toggle').checked = config.soundEnabled;
                    document.getElementById('music-toggle').checked = config.musicEnabled;
                    
                    // –ì—Ä–æ–º–∫–æ—Å—Ç—å
                    document.getElementById('music-volume').value = Math.round(config.musicVolume * 100);
                    document.getElementById('music-volume-value').textContent = Math.round(config.musicVolume * 100);
                    document.getElementById('sfx-volume').value = Math.round(config.sfxVolume * 100);
                    document.getElementById('sfx-volume-value').textContent = Math.round(config.sfxVolume * 100);
                    
                    this.updateCurrentSettings();
                }
            },
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            init() {
                console.log('üéÆ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
                
                this.cacheElements();
                this.initSnowflakes();
                this.initAudio();
                this.initEventListeners();
                this.initSettings();
                this.showStartScreen();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç—Å–∫–µ–π–ø-—Å–∏—Å—Ç–µ–º—ã
                this.escapeSystem.init();
                
                console.log('‚úÖ –ò–≥—Ä–∞ –≥–æ—Ç–æ–≤–∞!');
            },
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–µ–∂–∏–Ω–æ–∫
            initSnowflakes() {
                const container = document.getElementById('snowflakes');
                container.innerHTML = '';
                
                for (let i = 0; i < this.config.snowflakesCount; i++) {
                    this.createSnowflake(container);
                }
            },
            
            createSnowflake(container) {
                const snowflake = document.createElement('div');
                const size = Math.random() * 3 + 2;
                const sizeClass = size < 3.5 ? 'small' : size < 5 ? 'medium' : 'large';
                
                snowflake.className = `snowflake ${sizeClass}`;
                
                // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
                snowflake.style.left = `${Math.random() * 100}%`;
                snowflake.style.opacity = `${Math.random() * 0.6 + 0.3}`;
                
                // –°–ª—É—á–∞–π–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–∞—á–∞–Ω–∏—è
                const swayDistance = Math.random() * 40 + 10;
                snowflake.style.setProperty('--sway-distance', `${swayDistance}px`);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞–¥–µ–Ω–∏—è
                const duration = Math.random() * 10 + 10;
                const delay = Math.random() * 5;
                const sway = Math.random() * 100 - 50;
                
                snowflake.style.setProperty('--sway', `${sway}px`);
                snowflake.style.animation = `
                    fall ${duration}s linear ${delay}s infinite,
                    sway ${duration * 2}s ease-in-out ${delay}s infinite
                `;
                
                container.appendChild(snowflake);
                
                // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–æ–≥–¥–∞ —Å–Ω–µ–∂–∏–Ω–∫–∞ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –Ω–∏–∑–∞
                setTimeout(() => {
                    this.resetSnowflake(snowflake);
                }, (duration + delay) * 1000);
            },
            
            resetSnowflake(snowflake) {
                snowflake.style.top = '-10px';
                snowflake.style.left = `${Math.random() * 100}%`;
                
                const duration = Math.random() * 10 + 10;
                const delay = Math.random() * 5;
                const sway = Math.random() * 100 - 50;
                
                snowflake.style.setProperty('--sway', `${sway}px`);
                snowflake.style.animation = `
                    fall ${duration}s linear ${delay}s infinite,
                    sway ${duration * 2}s ease-in-out ${delay}s infinite
                `;
                
                setTimeout(() => {
                    this.resetSnowflake(snowflake);
                }, (duration + delay) * 1000);
            },
            
            cacheElements() {
                this.elements = {
                    gameBoard: document.getElementById('game-board'),
                    startScreen: document.getElementById('start-screen'),
                    startGameBtn: document.getElementById('start-game'),
                    startButtonMain: document.getElementById('start-button-main'),
                    restartBtn: document.getElementById('restart-btn'),
                    hintBtn: document.getElementById('hint-btn'),
                    undoBtn: document.getElementById('undo-btn'),
                    timer: document.getElementById('timer'),
                    mainTimer: document.getElementById('main-timer'),
                    mineCount: document.getElementById('mine-count'),
                    bombCount: document.getElementById('bomb-count'),
                    bombTimer: document.getElementById('bomb-timer'),
                    playMusicBtn: document.getElementById('play-music'),
                    pauseMusicBtn: document.getElementById('pause-music'),
                    stopMusicBtn: document.getElementById('stop-music'),
                    musicUpload: document.getElementById('music-upload'),
                    musicVolume: document.getElementById('music-volume'),
                    sfxVolume: document.getElementById('sfx-volume'),
                    musicVolumeValue: document.getElementById('music-volume-value'),
                    sfxVolumeValue: document.getElementById('sfx-volume-value'),
                    musicStatus: document.getElementById('music-status'),
                    soundToggle: document.getElementById('sound-toggle'),
                    musicToggle: document.getElementById('music-toggle')
                };
            },
            
            initAudio() {
                try {
                    // –°–æ–∑–¥–∞–µ–º AudioContext –¥–ª—è –∑–≤—É–∫–æ–≤
                    this.state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // –°–æ–∑–¥–∞–µ–º gain –Ω–æ–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç—å—é
                    this.state.musicGainNode = this.state.audioContext.createGain();
                    this.state.sfxGainNode = this.state.audioContext.createGain();
                    
                    // –ü–æ–¥–∫–ª—é—á–∞–µ–º gain –Ω–æ–¥—ã –∫ –≤—ã—Ö–æ–¥—É
                    this.state.musicGainNode.connect(this.state.audioContext.destination);
                    this.state.sfxGainNode.connect(this.state.audioContext.destination);
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –≥—Ä–æ–º–∫–æ—Å—Ç—å
                    this.state.musicGainNode.gain.value = this.config.musicVolume;
                    this.state.sfxGainNode.gain.value = this.config.sfxVolume;
                    
                    // –°–æ–∑–¥–∞–µ–º —É–ª—É—á—à–µ–Ω–Ω—ã–µ –∑–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
                    this.createEnhancedSounds();
                    
                    // –°–æ–∑–¥–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É
                    this.createBackgroundMusic();
                    
                    console.log('üîä –ê—É–¥–∏–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
                } catch (e) {
                    console.log('‚ö†Ô∏è –ê—É–¥–∏–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
                    this.config.soundEnabled = false;
                    this.config.musicEnabled = false;
                }
            },
            
            createEnhancedSounds() {
                try {
                    // –ë–æ–ª–µ–µ –ø—Ä–∏—è—Ç–Ω—ã–µ –∏ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –∑–≤—É–∫–∏
                    this.state.sounds = {
                        // –ú—è–≥–∫–∏–π –∫–ª–∏–∫ (–ø–∏–∞–Ω–∏–Ω–æ C4)
                        click: () => this.playTone(261.63, 0.1, 'sine', 0.05, 0.1),
                        
                        // –ö–æ–ª–æ–∫–æ–ª—å—á–∏–∫ –¥–ª—è —Ñ–ª–∞–≥–∞ (–∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫)
                        flag: () => this.playBellSound(784.00, 0.3),
                        
                        // –ü—Ä–∏—è—Ç–Ω—ã–π –∑–≤—É–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è (–∞—Ä–ø–µ–¥–∂–∏–æ)
                        reveal: () => this.playArpeggio([523.25, 659.25, 783.99], 0.4, 0.15),
                        
                        // –ì–ª—É—Ö–æ–π –≤–∑—Ä—ã–≤ –¥–ª—è –º–∏–Ω—ã (–Ω–∏–∑–∫–∏–π –±–∞—Å)
                        mine: () => this.playExplosionSound(),
                        
                        // –†–∞–¥–æ—Å—Ç–Ω—ã–π –∑–≤—É–∫ –ø–æ–±–µ–¥—ã (–º–∞–∂–æ—Ä–Ω–æ–µ –∞—Ä–ø–µ–¥–∂–∏–æ)
                        win: () => this.playArpeggio([523.25, 659.25, 783.99, 1046.50], 0.8, 0.2),
                        
                        // –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–Ω—ã–π –∑–≤—É–∫ –¥–≤–∏–∂–µ–Ω–∏—è –±–æ–º–±—ã (—Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä)
                        bombMove: () => this.playSynthSound(220, 0.4),
                        
                        // –ú—è–≥–∫–∏–π –∑–≤—É–∫ –æ—à–∏–±–∫–∏ (–º–∏–Ω–æ—Ä–Ω–∞—è —Ç–µ—Ä—Ü–∏—è)
                        error: () => this.playTone(220, 0.2, 'sine', 0.1, 0.1, true),
                        
                        // –ü—Ä–∏—è—Ç–Ω—ã–π –∑–≤—É–∫ –Ω–∞–≤–µ–¥–µ–Ω–∏—è (–≤—ã—Å–æ–∫–∏–π –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫)
                        hover: () => this.playTone(1046.50, 0.08, 'sine', 0.05, 0.05)
                    };
                } catch (e) {
                    console.log('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–≤—É–∫–æ–≤:', e);
                    // –°–æ–∑–¥–∞–µ–º –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –∑–≤—É–∫–æ–≤
                    this.state.sounds = {
                        click: () => {},
                        flag: () => {},
                        reveal: () => {},
                        mine: () => {},
                        win: () => {},
                        bombMove: () => {},
                        error: () => {},
                        hover: () => {}
                    };
                }
            },
            
            createBackgroundMusic() {
                try {
                    // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É —Å –ø–æ–º–æ—â—å—é Web Audio API
                    const audioContext = this.state.audioContext;
                    
                    // –°–æ–∑–¥–∞–µ–º –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç–æ—Ç
                    const frequencies = [220, 277.18, 329.63, 440]; // A3, C#4, E4, A4
                    const oscillators = [];
                    const gains = [];
                    
                    // –°–æ–∑–¥–∞–µ–º –ø–∞—Ä—É –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–æ–≤ –¥–ª—è –º–µ–ª–æ–¥–∏–∏
                    for (let i = 0; i < frequencies.length; i++) {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(this.state.musicGainNode);
                        osc.frequency.value = frequencies[i];
                        osc.type = i % 2 === 0 ? 'sine' : 'triangle';
                        gain.gain.value = 0; // –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ - —Ç–∏—à–∏–Ω–∞
                        
                        oscillators.push(osc);
                        gains.push(gain);
                    }
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                    this.state.musicOscillators = oscillators;
                    this.state.musicGains = gains;
                    
                    // –ù–∞—á–∏–Ω–∞–µ–º –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã (–æ–Ω–∏ –±—É–¥—É—Ç —Ç–∏—Ö–∏–º–∏ –¥–æ –≤–∫–ª—é—á–µ–Ω–∏—è –º—É–∑—ã–∫–∏)
                    oscillators.forEach(osc => osc.start());
                    
                    // –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –º—É–∑—ã–∫–∏
                    this.animateMusic();
                    
                } catch (e) {
                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É:', e);
                }
            },
            
            animateMusic() {
                if (!this.config.musicEnabled || !this.state.musicGains || !this.state.isMusicPlaying) return;
                
                const time = this.state.audioContext.currentTime;
                const melodyGains = this.state.musicGains;
                
                // –°–ª—É—á–∞–π–Ω–∞—è –º–µ–ª–æ–¥–∏—è (–∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã)
                setTimeout(() => {
                    if (this.config.musicEnabled && this.state.isMusicPlaying) {
                        const melodyIndex = Math.floor(Math.random() * melodyGains.length);
                        const melodyGain = melodyGains[melodyIndex];
                        
                        const melodyTime = this.state.audioContext.currentTime;
                        melodyGain.gain.setValueAtTime(0, melodyTime);
                        melodyGain.gain.linearRampToValueAtTime(0.3, melodyTime + 0.1);
                        melodyGain.gain.exponentialRampToValueAtTime(0.001, melodyTime + 0.8);
                    }
                }, 2000);
                
                // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤
                if (this.state.isMusicPlaying) {
                    setTimeout(() => this.animateMusic(), 3000);
                }
            },
            
            playTone(frequency, duration, type, attack = 0.1, decay = 0.3, downward = false) {
                if (!this.config.soundEnabled || !this.state.audioContext) return;
                
                try {
                    const oscillator = this.state.audioContext.createOscillator();
                    const gainNode = this.state.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.state.sfxGainNode);
                    
                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å—Ç–æ—Ç—ã
                    if (downward) {
                        oscillator.frequency.setValueAtTime(frequency * 1.5, this.state.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(frequency * 0.7, this.state.audioContext.currentTime + duration);
                    } else {
                        oscillator.frequency.value = frequency;
                    }
                    
                    oscillator.type = type;
                    
                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–≥–∏–±–∞—é—â–µ–π
                    const volume = 0.3; // –ë–∞–∑–æ–≤–∞—è –≥—Ä–æ–º–∫–æ—Å—Ç—å, –±—É–¥–µ—Ç —É–º–Ω–æ–∂–µ–Ω–∞ –Ω–∞ sfxGainNode
                    gainNode.gain.setValueAtTime(0.001, this.state.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(volume, this.state.audioContext.currentTime + attack);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, this.state.audioContext.currentTime + attack + decay);
                    
                    oscillator.start(this.state.audioContext.currentTime);
                    oscillator.stop(this.state.audioContext.currentTime + duration);
                } catch(e) {
                    console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:', e);
                }
            },
            
            playBellSound(frequency, duration) {
                if (!this.config.soundEnabled || !this.state.audioContext) return;
                
                try {
                    // –°–æ–∑–¥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–æ–≤ –¥–ª—è –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫–∞
                    const osc1 = this.state.audioContext.createOscillator();
                    const osc2 = this.state.audioContext.createOscillator();
                    const gainNode = this.state.audioContext.createGain();
                    
                    osc1.connect(gainNode);
                    osc2.connect(gainNode);
                    gainNode.connect(this.state.sfxGainNode);
                    
                    osc1.frequency.value = frequency;
                    osc2.frequency.value = frequency * 2.5;
                    osc1.type = 'sine';
                    osc2.type = 'triangle';
                    
                    const now = this.state.audioContext.currentTime;
                    
                    gainNode.gain.setValueAtTime(0.001, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.25, now + 0.1);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration);
                    
                    osc1.start(now);
                    osc2.start(now);
                    osc1.stop(now + duration);
                    osc2.stop(now + duration);
                } catch(e) {
                    console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫–∞:', e);
                }
            },
            
            playExplosionSound() {
                if (!this.config.soundEnabled || !this.state.audioContext) return;
                
                try {
                    const oscillator = this.state.audioContext.createOscillator();
                    const gainNode = this.state.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.state.sfxGainNode);
                    
                    oscillator.frequency.setValueAtTime(150, this.state.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(20, this.state.audioContext.currentTime + 0.8);
                    oscillator.type = 'sawtooth';
                    
                    const now = this.state.audioContext.currentTime;
                    
                    gainNode.gain.setValueAtTime(0.001, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.4, now + 0.05);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.8);
                    
                    oscillator.start(now);
                    oscillator.stop(now + 0.8);
                } catch(e) {
                    console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∑—Ä—ã–≤–∞:', e);
                }
            },
            
            playSynthSound(frequency, duration) {
                if (!this.config.soundEnabled || !this.state.audioContext) return;
                
                try {
                    const oscillator = this.state.audioContext.createOscillator();
                    const gainNode = this.state.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.state.sfxGainNode);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–±—Ä–∞—Ç–æ
                    const vibrato = this.state.audioContext.createOscillator();
                    const vibratoGain = this.state.audioContext.createGain();
                    
                    vibrato.connect(vibratoGain);
                    vibratoGain.connect(oscillator.frequency);
                    vibrato.frequency.value = 5;
                    vibratoGain.gain.value = 10;
                    
                    oscillator.frequency.value = frequency;
                    oscillator.type = 'square';
                    
                    const now = this.state.audioContext.currentTime;
                    
                    gainNode.gain.setValueAtTime(0.001, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.2, now + 0.1);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration);
                    
                    oscillator.start(now);
                    vibrato.start(now);
                    oscillator.stop(now + duration);
                    vibrato.stop(now + duration);
                } catch(e) {
                    console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–∞:', e);
                }
            },
            
            playArpeggio(frequencies, duration, delay = 0.1) {
                if (!this.config.soundEnabled || !this.state.audioContext) return;
                
                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        this.playTone(freq, duration * 0.8, 'sine', 0.1, 0.2);
                    }, index * delay * 1000);
                });
            },
            
            playSound(soundName) {
                if (this.state.sounds[soundName] && this.config.soundEnabled) {
                    this.state.sounds[soundName]();
                }
            },
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—É–∑—ã–∫–æ–π
            playMusic() {
                if (!this.config.musicEnabled) return;
                
                this.state.isMusicPlaying = true;
                
                // –í–∫–ª—é—á–∞–µ–º –º—É–∑—ã–∫—É –ø–ª–∞–≤–Ω–æ
                const now = this.state.audioContext.currentTime;
                this.state.musicGainNode.gain.setValueAtTime(this.state.musicGainNode.gain.value, now);
                this.state.musicGainNode.gain.linearRampToValueAtTime(this.config.musicVolume, now + 1);
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –º—É–∑—ã–∫–∏
                this.animateMusic();
                
                this.elements.musicStatus.textContent = 'üé∂ –ú—É–∑—ã–∫–∞: –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è';
                this.showMessage('üéµ –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞');
            },
            
            pauseMusic() {
                this.state.isMusicPlaying = false;
                
                const now = this.state.audioContext.currentTime;
                this.state.musicGainNode.gain.setValueAtTime(this.state.musicGainNode.gain.value, now);
                this.state.musicGainNode.gain.linearRampToValueAtTime(0.001, now + 0.5);
                
                this.elements.musicStatus.textContent = 'üé∂ –ú—É–∑—ã–∫–∞: –ù–∞ –ø–∞—É–∑–µ';
                this.showMessage('‚è∏ –ú—É–∑—ã–∫–∞ –Ω–∞ –ø–∞—É–∑–µ');
            },
            
            stopMusic() {
                this.state.isMusicPlaying = false;
                
                const now = this.state.audioContext.currentTime;
                this.state.musicGainNode.gain.setValueAtTime(this.state.musicGainNode.gain.value, now);
                this.state.musicGainNode.gain.linearRampToValueAtTime(0.001, now + 0.3);
                
                this.elements.musicStatus.textContent = 'üé∂ –ú—É–∑—ã–∫–∞: –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞';
                this.showMessage('‚èπ –ú—É–∑—ã–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
            },
            
            setMusicVolume(volume) {
                this.config.musicVolume = volume / 100;
                this.elements.musicVolumeValue.textContent = volume;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å –µ—Å–ª–∏ –º—É–∑—ã–∫–∞ –∏–≥—Ä–∞–µ—Ç
                if (this.state.musicGainNode) {
                    const now = this.state.audioContext.currentTime;
                    this.state.musicGainNode.gain.setValueAtTime(this.state.musicGainNode.gain.value, now);
                    this.state.musicGainNode.gain.linearRampToValueAtTime(this.config.musicVolume, now + 0.1);
                }
            },
            
            setSfxVolume(volume) {
                this.config.sfxVolume = volume / 100;
                this.elements.sfxVolumeValue.textContent = volume;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å –∑–≤—É–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
                if (this.state.sfxGainNode) {
                    const now = this.state.audioContext.currentTime;
                    this.state.sfxGainNode.gain.setValueAtTime(this.state.sfxGainNode.gain.value, now);
                    this.state.sfxGainNode.gain.linearRampToValueAtTime(this.config.sfxVolume, now + 0.1);
                }
            },
            
            toggleMusic() {
                this.config.musicEnabled = !this.config.musicEnabled;
                this.elements.musicToggle.checked = this.config.musicEnabled;
                
                if (this.config.musicEnabled) {
                    this.playMusic();
                } else {
                    this.pauseMusic();
                }
            },
            
            initEventListeners() {
                // –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –∏–≥—Ä—ã
                this.elements.startGameBtn.addEventListener('click', () => this.startNewGame());
                this.elements.startButtonMain.addEventListener('click', () => this.startNewGame());
                this.elements.restartBtn.addEventListener('click', () => this.startNewGame());
                this.elements.hintBtn.addEventListener('click', () => this.giveHint());
                this.elements.undoBtn.addEventListener('click', () => this.undoMove());
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—É–∑—ã–∫–æ–π
                this.elements.playMusicBtn.addEventListener('click', () => this.playMusic());
                this.elements.pauseMusicBtn.addEventListener('click', () => this.pauseMusic());
                this.elements.stopMusicBtn.addEventListener('click', () => this.stopMusic());
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≤–æ–µ–π –º—É–∑—ã–∫–∏
                this.elements.musicUpload.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const url = URL.createObjectURL(file);
                        this.stopMusic();
                        this.elements.musicStatus.textContent = `üé∂ –ú—É–∑—ã–∫–∞: ${file.name}`;
                        this.showMessage(`–ó–∞–≥—Ä—É–∂–µ–Ω–∞ –º—É–∑—ã–∫–∞: ${file.name}`);
                    }
                });
                
                // –†–µ–≥—É–ª—è—Ç–æ—Ä—ã –≥—Ä–æ–º–∫–æ—Å—Ç–∏
                this.elements.musicVolume.addEventListener('input', (e) => {
                    this.setMusicVolume(e.target.value);
                });
                
                this.elements.sfxVolume.addEventListener('input', (e) => {
                    this.setSfxVolume(e.target.value);
                });
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –∑–≤—É–∫–∞
                this.elements.soundToggle.addEventListener('change', (e) => {
                    this.config.soundEnabled = e.target.checked;
                    this.showMessage(this.config.soundEnabled ? 'üîä –ó–≤—É–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã' : 'üîá –ó–≤—É–∫–∏ –≤—ã–∫–ª—é—á–µ–Ω—ã');
                });
                
                this.elements.musicToggle.addEventListener('change', (e) => {
                    this.toggleMusic();
                });
                
                // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'z') {
                        e.preventDefault();
                        this.undoMove();
                    } else if (e.key === ' ') {
                        e.preventDefault();
                        this.giveHint();
                    } else if (e.key === 'r' || e.key === 'R') {
                        this.startNewGame();
                    } else if (e.key === 'm' || e.key === 'M') {
                        e.preventDefault();
                        this.toggleMusic();
                    }
                });
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–∞–≤–µ–¥–µ–Ω–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏
                const buttons = document.querySelectorAll('.btn, .audio-btn, .audio-upload-label');
                buttons.forEach(btn => {
                    btn.addEventListener('mouseenter', () => {
                        this.playSound('hover');
                    });
                });

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
                const updateCallbacks = [
                    'board-size', 'mine-count-slider', 'dynamic-bomb-count',
                    'smart-gen', 'sound-toggle', 'music-toggle',
                    'music-volume', 'sfx-volume'
                ];

                updateCallbacks.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('change', () => {
                            setTimeout(() => {
                                this.escapeSystem.updateCurrentSettings();
                            }, 100);
                        });
                    }
                });
            },
            
            initSettings() {
                // –†–∞–∑–º–µ—Ä –ø–æ–ª—è
                const sizeSlider = document.getElementById('board-size');
                const sizeValue = document.getElementById('size-value');
                
                const updateSize = () => {
                    const size = parseInt(sizeSlider.value);
                    this.config.rows = this.config.cols = size;
                    sizeValue.textContent = `${size}√ó${size}`;
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω
                    this.adjustMineCount();
                };
                
                sizeSlider.addEventListener('input', updateSize);
                updateSize(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
                
                // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω
                const mineSlider = document.getElementById('mine-count-slider');
                const mineValue = document.getElementById('mine-value');
                
                const updateMines = () => {
                    const maxMines = this.config.rows * this.config.cols - 9 - this.config.dynamicBombs;
                    this.config.mines = Math.min(
                        Math.max(5, parseInt(mineSlider.value)),
                        maxMines
                    );
                    mineValue.textContent = this.config.mines;
                    mineSlider.value = this.config.mines;
                    this.updateUI();
                };
                
                mineSlider.addEventListener('input', updateMines);
                updateMines(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
                
                // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –±–æ–º–±—ã
                const bombSlider = document.getElementById('dynamic-bomb-count');
                const bombValue = document.getElementById('bomb-value');
                
                const updateBombs = () => {
                    const maxBombs = this.config.rows * this.config.cols - 9 - this.config.mines;
                    this.config.dynamicBombs = Math.min(
                        Math.max(1, parseInt(bombSlider.value)),
                        maxBombs
                    );
                    bombValue.textContent = this.config.dynamicBombs;
                    bombSlider.value = this.config.dynamicBombs;
                    this.updateUI();
                };
                
                bombSlider.addEventListener('input', updateBombs);
                updateBombs(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
                
                // –£–º–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
                document.getElementById('smart-gen').addEventListener('change', (e) => {
                    this.config.smartGeneration = e.target.checked;
                });
            },
            
            adjustMineCount() {
                const maxMines = this.config.rows * this.config.cols - 9 - this.config.dynamicBombs;
                if (this.config.mines > maxMines) {
                    this.config.mines = maxMines;
                    document.getElementById('mine-count-slider').value = this.config.mines;
                    document.getElementById('mine-value').textContent = this.config.mines;
                }
            },
            
            showStartScreen() {
                this.elements.startScreen.classList.remove('hidden');
            },
            
            hideStartScreen() {
                this.elements.startScreen.classList.add('hidden');
            },
            
            startNewGame() {
                console.log('üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞');
                
                this.hideStartScreen();
                this.resetGameState();
                this.createBoard();
                this.updateUI();
                this.renderBoard();
                
                this.showMessage('üéÆ –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –°–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Ö–æ–¥');
                this.playSound('click');
            },
            
            resetGameState() {
                this.state = {
                    ...this.state,
                    board: [],
                    gameOver: false,
                    gameWon: false,
                    firstClick: true,
                    flaggedCount: 0,
                    revealedCount: 0,
                    startTime: null,
                    timerInterval: null,
                    bombTimer: null,
                    bombMoveCounter: 0,
                    elapsedSeconds: 0,
                    lastMoveHistory: []
                };
                
                this.stopTimers();
                
                // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–æ–≤ –≤ UI
                this.elements.timer.textContent = '000';
                this.elements.mainTimer.textContent = '000';
                this.elements.bombTimer.textContent = '12';
            },
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—è
            createBoard() {
                this.state.board = [];
                
                for (let r = 0; r < this.config.rows; r++) {
                    this.state.board[r] = [];
                    for (let c = 0; c < this.config.cols; c++) {
                        this.state.board[r][c] = {
                            row: r,
                            col: c,
                            isMine: false,
                            isDynamicBomb: false,
                            isRevealed: false,
                            isFlagged: false,
                            neighborMines: 0,
                            neighborDynamicBombs: 0  // –ù–û–í–û–ï: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –±–æ–º–± —Ä—è–¥–æ–º
                        };
                    }
                }
            },
            
            renderBoard() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª–µ –∑–∞–Ω–æ–≤–æ
                const existingCells = this.elements.gameBoard.querySelectorAll('.cell');
                
                if (existingCells.length === 0 || 
                    existingCells.length !== this.config.rows * this.config.cols) {
                    // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—è
                    this.elements.gameBoard.innerHTML = '';
                    this.elements.gameBoard.style.gridTemplateColumns = `repeat(${this.config.cols}, 1fr)`;
                    this.elements.gameBoard.style.gridTemplateRows = `repeat(${this.config.rows}, 1fr)`;
                    
                    for (let r = 0; r < this.config.rows; r++) {
                        for (let c = 0; c < this.config.cols; c++) {
                            this.createCellElement(r, c);
                        }
                    }
                } else {
                    // –¢–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –∫–ª–µ—Ç–∫–∏
                    this.updateChangedCells();
                }
            },
            
            createCellElement(row, col) {
                const cell = this.state.board[row][col];
                const cellElement = document.createElement('div');
                cellElement.className = 'cell';
                cellElement.dataset.row = row;
                cellElement.dataset.col = col;
                
                this.updateCellAppearance(cellElement, cell);
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
                cellElement.addEventListener('click', (e) => this.handleCellClick(row, col, e));
                cellElement.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.handleRightClick(row, col);
                });
                
                this.elements.gameBoard.appendChild(cellElement);
            },
            
            updateCellAppearance(cellElement, cell) {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–ª–∞—Å—Å—ã
                cellElement.className = 'cell';
                cellElement.textContent = '';
                cellElement.style.animation = '';
                
                // –û—Ç–∫—Ä—ã—Ç—ã–µ –∫–ª–µ—Ç–∫–∏
                if (cell.isRevealed) {
                    cellElement.classList.add('revealed');
                    
                    if (cell.isMine) {
                        cellElement.classList.add('mine');
                        cellElement.innerHTML = 'üí£';
                    } else if (cell.isDynamicBomb) {
                        cellElement.classList.add('dynamic-bomb');
                        cellElement.innerHTML = 'üí•';
                    } else if (cell.neighborMines > 0) {
                        cellElement.classList.add(`number-${cell.neighborMines}`);
                        cellElement.textContent = cell.neighborMines;
                    } else if (cell.neighborDynamicBombs > 0) {
                        // –ù–û–í–û–ï: –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –±–æ–º–± —Ä—è–¥–æ–º
                        cellElement.classList.add(`dynamic-bombs-${Math.min(cell.neighborDynamicBombs, 3)}`);
                        cellElement.textContent = cell.neighborDynamicBombs;
                        cellElement.title = `–†—è–¥–æ–º ${cell.neighborDynamicBombs} –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –±–æ–º–±`;
                    }
                } 
                // –ó–∞–∫—Ä—ã—Ç—ã–µ –∫–ª–µ—Ç–∫–∏
                else {
                    if (cell.isFlagged) {
                        cellElement.classList.add('flagged');
                    }
                }
            },
            
            updateChangedCells() {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ –∫–ª–µ—Ç–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
                for (let r = 0; r < this.config.rows; r++) {
                    for (let c = 0; c < this.config.cols; c++) {
                        const cell = this.state.board[r][c];
                        const cellElement = this.elements.gameBoard.querySelector(
                            `.cell[data-row="${r}"][data-col="${c}"]`
                        );
                        
                        if (cellElement) {
                            this.updateCellAppearance(cellElement, cell);
                        }
                    }
                }
            },
            
            generateMines(firstRow, firstCol) {
                console.log('üí£ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–Ω...');
                
                const safeZone = this.getSafeZone(firstRow, firstCol);
                const totalCells = this.config.rows * this.config.cols;
                const safeZoneSize = safeZone.size;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω
                const maxMines = totalCells - safeZoneSize - this.config.dynamicBombs;
                this.config.mines = Math.max(5, Math.min(this.config.mines, maxMines));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                document.getElementById('mine-count-slider').value = this.config.mines;
                document.getElementById('mine-value').textContent = this.config.mines;
                this.updateUI();
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –º–∏–Ω—ã –∏ –±–æ–º–±—ã
                for (let r = 0; r < this.config.rows; r++) {
                    for (let c = 0; c < this.config.cols; c++) {
                        this.state.board[r][c].isMine = false;
                        this.state.board[r][c].isDynamicBomb = false;
                        this.state.board[r][c].neighborMines = 0;
                        this.state.board[r][c].neighborDynamicBombs = 0; // –ù–û–í–û–ï: —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –±–æ–º–±
                    }
                }
                
                const allCells = [];
                for (let r = 0; r < this.config.rows; r++) {
                    for (let c = 0; c < this.config.cols; c++) {
                        if (!safeZone.has(`${r},${c}`)) {
                            allCells.push({ r, c });
                        }
                    }
                }
                
                // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –º–∞—Å—Å–∏–≤
                for (let i = allCells.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [allCells[i], allCells[j]] = [allCells[j], allCells[i]];
                }
                
                // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∏–Ω—ã
                let minesPlaced = 0;
                let attempts = 0;
                const maxAttempts = allCells.length * 2;
                
                while (minesPlaced < this.config.mines && attempts < maxAttempts) {
                    const { r, c } = allCells[minesPlaced % allCells.length];
                    
                    if (this.config.smartGeneration) {
                        if (this.countNeighborMines(r, c, 'isMine') < 2) {
                            this.state.board[r][c].isMine = true;
                            minesPlaced++;
                        }
                    } else {
                        this.state.board[r][c].isMine = true;
                        minesPlaced++;
                    }
                    attempts++;
                }
                
                // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤—Å–µ –º–∏–Ω—ã, —Ä–∞–∑–º–µ—â–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Å–ª—É—á–∞–π–Ω–æ
                if (minesPlaced < this.config.mines) {
                    for (let i = 0; i < allCells.length && minesPlaced < this.config.mines; i++) {
                        const { r, c } = allCells[i];
                        if (!this.state.board[r][c].isMine && !safeZone.has(`${r},${c}`)) {
                            this.state.board[r][c].isMine = true;
                            minesPlaced++;
                        }
                    }
                }
                
                // –†–∞—Å—Å—Ç–∞–≤–ª—è–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –±–æ–º–±—ã
                let bombsPlaced = 0;
                const availableForBombs = allCells.filter(({ r, c }) => 
                    !this.state.board[r][c].isMine && !safeZone.has(`${r},${c}`)
                );
                
                for (let i = 0; i < availableForBombs.length && bombsPlaced < this.config.dynamicBombs; i++) {
                    const { r, c } = availableForBombs[i];
                    this.state.board[r][c].isDynamicBomb = true;
                    bombsPlaced++;
                }
                
                // –°—á–∏—Ç–∞–µ–º —Å–æ—Å–µ–¥–µ–π (–≤–∫–ª—é—á–∞—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –±–æ–º–±—ã)
                this.calculateNeighbors();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä—ã
                this.startTimers();
                
                console.log(`‚úÖ –†–∞—Å—Å—Ç–∞–≤–ª–µ–Ω–æ: ${minesPlaced} –º–∏–Ω, ${bombsPlaced} –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –±–æ–º–±`);
            },
            
            getSafeZone(row, col) {
                const safeZone = new Set();
                
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        const nr = row + dr;
                        const nc = col + dc;
                        
                        if (nr >= 0 && nr < this.config.rows && nc >= 0 && nc < this.config.cols) {
                            safeZone.add(`${nr},${nc}`);
                        }
                    }
                }
                
                return safeZone;
            },
            
            countNeighborMines(row, col, type) {
                let count = 0;
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        if (dr === 0 && dc === 0) continue;
                        
                        const nr = row + dr;
                        const nc = col + dc;
                        
                        if (nr >= 0 && nr < this.config.rows && nc >= 0 && nc < this.config.cols) {
                            if (this.state.board[nr][nc][type]) {
                                count++;
                            }
                        }
                    }
                }
                return count;
            },
            
            calculateNeighbors() {
                for (let r = 0; r < this.config.rows; r++) {
                    for (let c = 0; c < this.config.cols; c++) {
                        const cell = this.state.board[r][c];
                        if (cell.isMine || cell.isDynamicBomb) continue;
                        
                        // –°—á–∏—Ç–∞–µ–º –æ–±—ã—á–Ω—ã–µ –º–∏–Ω—ã
                        cell.neighborMines = this.countNeighborMines(r, c, 'isMine');
                        
                        // –ù–û–í–û–ï: —Å—á–∏—Ç–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –±–æ–º–±—ã
                        cell.neighborDynamicBombs = this.countNeighborMines(r, c, 'isDynamicBomb');
                    }
                }
            },
            
            handleCellClick(row, col, event) {
                if (this.state.gameOver || this.state.gameWon) return;
                
                const cell = this.state.board[row][col];
                
                if (cell.isFlagged) {
                    this.playSound('error');
                    return;
                }
                
                if (this.state.firstClick) {
                    this.state.firstClick = false;
                    this.generateMines(row, col);
                    this.playSound('click');
                }
                
                this.saveMoveState();
                
                if (cell.isMine) {
                    this.playSound('mine');
                    this.gameOver(false);
                    return;
                }
                
                if (cell.isDynamicBomb) {
                    this.playSound('mine');
                    this.gameOver(false);
                    return;
                }
                
                this.revealCell(row, col);
                this.checkWin();
            },
            
            handleRightClick(row, col) {
                if (this.state.gameOver || this.state.gameWon) return;
                
                const cell = this.state.board[row][col];
                if (cell.isRevealed) return;
                
                this.saveMoveState();
                
                cell.isFlagged = !cell.isFlagged;
                if (cell.isFlagged) {
                    this.state.flaggedCount++;
                    this.playSound('flag');
                } else {
                    this.state.flaggedCount--;
                    this.playSound('click');
                }
                
                this.updateUI();
                this.renderBoard();
            },
            
            saveMoveState() {
                const stateSnapshot = {
                    board: JSON.parse(JSON.stringify(this.state.board)),
                    flaggedCount: this.state.flaggedCount,
                    revealedCount: this.state.revealedCount
                };
                
                this.state.lastMoveHistory.push(stateSnapshot);
                
                if (this.state.lastMoveHistory.length > 10) {
                    this.state.lastMoveHistory.shift();
                }
            },
            
            revealCell(row, col) {
                if (row < 0 || row >= this.config.rows || col < 0 || col >= this.config.cols) return;
                
                const cell = this.state.board[row][col];
                if (cell.isRevealed || cell.isFlagged) return;
                
                cell.isRevealed = true;
                this.state.revealedCount++;
                
                this.playSound('reveal');
                
                if (!cell.isMine && cell.neighborMines === 0 && cell.neighborDynamicBombs === 0) {
                    for (let dr = -1; dr <= 1; dr++) {
                        for (let dc = -1; dc <= 1; dc++) {
                            if (dr === 0 && dc === 0) continue;
                            this.revealCell(row + dr, col + dc);
                        }
                    }
                }
                
                this.renderBoard();
            },
            
            checkWin() {
                const totalCells = this.config.rows * this.config.cols;
                const totalSafeCells = totalCells - this.config.mines - this.config.dynamicBombs;
                
                if (this.state.revealedCount === totalSafeCells) {
                    this.gameOver(true);
                }
            },
            
            gameOver(isWin) {
                if (this.state.gameOver) return; // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ
                
                this.state.gameOver = true;
                this.state.gameWon = isWin;
                
                this.stopTimers();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –º–∏–Ω—ã
                for (let r = 0; r < this.config.rows; r++) {
                    for (let c = 0; c < this.config.cols; c++) {
                        const cell = this.state.board[r][c];
                        if ((cell.isMine || cell.isDynamicBomb) && !cell.isRevealed) {
                            cell.isRevealed = true;
                        }
                    }
                }
                
                this.renderBoard();
                
                // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
                setTimeout(() => {
                    if (isWin) {
                        this.playSound('win');
                        const time = this.elements.timer.textContent;
                        this.showMessage(`üéâ –ü–û–ë–ï–î–ê! –í—Ä–µ–º—è: ${time} —Å–µ–∫—É–Ω–¥. –•–æ–¥–æ–≤ –±–æ–º–±: ${this.state.bombMoveCounter}`);
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º alert —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
                        setTimeout(() => {
                            if (confirm(`üéâ –ü–û–ë–ï–î–ê!\n–í—Ä–µ–º—è: ${time} —Å–µ–∫—É–Ω–¥\n–•–æ–¥–æ–≤ –±–æ–º–±: ${this.state.bombMoveCounter}\n\n–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É?`)) {
                                this.startNewGame();
                            }
                        }, 1000);
                    } else {
                        this.showMessage('üí• –ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê! –í—ã –ø–æ–ø–∞–ª–∏ –Ω–∞ –º–∏–Ω—É');
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º alert —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
                        setTimeout(() => {
                            if (confirm('üí• –ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê!\n–í—ã –ø–æ–ø–∞–ª–∏ –Ω–∞ –º–∏–Ω—É\n\n–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑?')) {
                                this.startNewGame();
                            }
                        }, 1000);
                    }
                }, 500);
            },
            
            startTimers() {
                this.stopTimers(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ç–∞–π–º–µ—Ä—ã
                
                this.state.startTime = Date.now();
                this.state.elapsedSeconds = 0;
                let lastSecond = -1;
                
                this.state.timerInterval = setInterval(() => {
                    this.state.elapsedSeconds = Math.floor((Date.now() - this.state.startTime) / 1000);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±–∞ —Ç–∞–π–º–µ—Ä—ã
                    const timeStr = this.state.elapsedSeconds.toString().padStart(3, '0');
                    this.elements.timer.textContent = timeStr;
                    this.elements.mainTimer.textContent = timeStr;
                    
                    // –ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ–∫—É–Ω–¥—ã
                    if (this.state.elapsedSeconds !== lastSecond) {
                        this.elements.mainTimer.classList.add('changing');
                        setTimeout(() => {
                            this.elements.mainTimer.classList.remove('changing');
                        }, 500);
                        lastSecond = this.state.elapsedSeconds;
                    }
                }, 100);
                
                // –¢–∞–π–º–µ—Ä –±–æ–º–±
                this.state.bombTimer = setInterval(() => {
                    this.moveDynamicBombs();
                }, this.config.bombInterval);
                
                this.updateBombTimer();
            },
            
            updateBombTimer() {
                if (this.state.bombTimer) {
                    const nextMove = Math.floor(this.config.bombInterval / 1000);
                    this.elements.bombTimer.textContent = nextMove;
                    
                    let counter = nextMove;
                    const countdown = setInterval(() => {
                        counter--;
                        this.elements.bombTimer.textContent = counter > 0 ? counter : 0;
                        
                        if (counter <= 0) {
                            clearInterval(countdown);
                        }
                    }, 1000);
                    
                    setTimeout(() => {
                        this.updateBombTimer();
                    }, this.config.bombInterval);
                }
            },
            
            stopTimers() {
                if (this.state.timerInterval) {
                    clearInterval(this.state.timerInterval);
                    this.state.timerInterval = null;
                }
                if (this.state.bombTimer) {
                    clearInterval(this.state.bombTimer);
                    this.state.bombTimer = null;
                }
            },
            
            moveDynamicBombs() {
                if (this.state.gameOver || this.state.gameWon) return;
                
                this.state.bombMoveCounter++;
                this.playSound('bombMove');
                
                const bombs = [];
                for (let r = 0; r < this.config.rows; r++) {
                    for (let c = 0; c < this.config.cols; c++) {
                        if (this.state.board[r][c].isDynamicBomb) {
                            bombs.push({ r, c });
                        }
                    }
                }
                
                bombs.forEach(bomb => {
                    const possibleMoves = [];
                    
                    for (let dr = -1; dr <= 1; dr++) {
                        for (let dc = -1; dc <= 1; dc++) {
                            if (dr === 0 && dc === 0) continue;
                            
                            const nr = bomb.r + dr;
                            const nc = bomb.c + dc;
                            
                            if (nr >= 0 && nr < this.config.rows && nc >= 0 && nc < this.config.cols) {
                                const cell = this.state.board[nr][nc];
                                if (!cell.isRevealed && !cell.isFlagged && !cell.isMine && !cell.isDynamicBomb) {
                                    possibleMoves.push({ r: nr, c: nc });
                                }
                            }
                        }
                    }
                    
                    if (possibleMoves.length > 0) {
                        const move = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
                        
                        this.state.board[bomb.r][bomb.c].isDynamicBomb = false;
                        this.state.board[move.r][move.c].isDynamicBomb = true;
                        
                        this.createWaveEffect(move.r, move.c);
                    }
                });
                
                // –ù–û–í–û–ï: –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–æ—Å–µ–¥–µ–π –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –±–æ–º–±
                this.calculateNeighbors();
                this.renderBoard();
                
                this.showMessage(`üí£ –ë–æ–º–±—ã –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏—Å—å! –•–æ–¥ #${this.state.bombMoveCounter}`);
            },
            
            createWaveEffect(row, col) {
                const cellElement = this.elements.gameBoard.querySelector(
                    `.cell[data-row="${row}"][data-col="${col}"]`
                );
                
                if (cellElement) {
                    const wave = document.createElement('div');
                    wave.className = 'wave-effect';
                    wave.style.cssText = `
                        position: absolute;
                        width: 45px;
                        height: 45px;
                        border: 2px solid #ff9f43;
                        border-radius: 50%;
                        pointer-events: none;
                        animation: wave 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                        left: ${col * 51 + 25}px;
                        top: ${row * 51 + 25}px;
                        z-index: 2;
                    `;
                    
                    this.elements.gameBoard.appendChild(wave);
                    setTimeout(() => {
                        if (wave.parentNode) {
                            wave.parentNode.removeChild(wave);
                        }
                    }, 800);
                }
            },
            
            giveHint() {
                if (this.state.gameOver || this.state.gameWon || this.state.firstClick) {
                    this.showMessage('–°–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Ö–æ–¥');
                    this.playSound('error');
                    return;
                }
                
                const safeCells = [];
                for (let r = 0; r < this.config.rows; r++) {
                    for (let c = 0; c < this.config.cols; c++) {
                        const cell = this.state.board[r][c];
                        if (!cell.isRevealed && !cell.isFlagged && !cell.isMine && !cell.isDynamicBomb) {
                            safeCells.push({ r, c, cell });
                        }
                    }
                }
                
                if (safeCells.length > 0) {
                    safeCells.sort((a, b) => a.cell.neighborMines - b.cell.neighborMines);
                    const hint = safeCells[0];
                    
                    const cellElement = this.elements.gameBoard.querySelector(
                        `.cell[data-row="${hint.r}"][data-col="${hint.c}"]`
                    );
                    
                    if (cellElement) {
                        cellElement.style.animation = 'mine-pulse 0.5s 3';
                        this.playSound('click');
                        this.showMessage(`üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∫–ª–µ—Ç–∫—É (${hint.r + 1}, ${hint.c + 1})`);
                    }
                } else {
                    this.showMessage('–ù–µ –æ—Å—Ç–∞–ª–æ—Å—å –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫');
                    this.playSound('error');
                }
            },
            
            undoMove() {
                if (this.state.lastMoveHistory.length === 0) {
                    this.showMessage('–ù–µ—Ç —Ö–æ–¥–æ–≤ –¥–ª—è –æ—Ç–º–µ–Ω—ã');
                    this.playSound('error');
                    return;
                }
                
                const previousState = this.state.lastMoveHistory.pop();
                this.state.board = previousState.board;
                this.state.flaggedCount = previousState.flaggedCount;
                this.state.revealedCount = previousState.revealedCount;
                
                this.updateUI();
                this.renderBoard();
                this.playSound('click');
                this.showMessage('–•–æ–¥ –æ—Ç–º–µ–Ω–µ–Ω');
            },
            
            updateUI() {
                const remainingMines = this.config.mines - this.state.flaggedCount;
                this.elements.mineCount.textContent = Math.max(0, remainingMines).toString().padStart(3, '0');
                
                this.elements.bombCount.textContent = this.config.dynamicBombs;
            },
            
            showMessage(text) {
                const existingMessages = document.querySelectorAll('.message');
                existingMessages.forEach(msg => {
                    msg.style.animation = 'slideInRight 0.4s ease-out reverse forwards';
                    setTimeout(() => {
                        if (msg.parentNode) {
                            msg.parentNode.removeChild(msg);
                        }
                    }, 400);
                });
                
                const message = document.createElement('div');
                message.className = 'message';
                message.textContent = text;
                
                document.body.appendChild(message);
                
                setTimeout(() => {
                    message.style.animation = 'slideInRight 0.4s ease-out reverse forwards';
                    setTimeout(() => {
                        if (message.parentNode) {
                            message.parentNode.removeChild(message);
                        }
                    }, 400);
                }, 3500);
            }
        };

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        document.addEventListener('DOMContentLoaded', () => {
            Game.init();
        });
    </script>
</body>
</html>
